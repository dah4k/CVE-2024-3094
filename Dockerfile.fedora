# Copyright 2024 dah4k
# SPDX-License-Identifier: MIT-0

FROM fedora:41 AS Builder

RUN dnf --assumeyes clean all \
 && dnf --assumeyes update \
 && dnf --assumeyes install \
    autoconf \
    automake \
    cmake \
    cpio \
    diffutils \
    fd-find \
    fdupes \
    gcc \
    gcc-c++ \
    gdb \
    gettext-devel \
    git \
    hexyl \
    libtool \
    make \
    ripgrep \
    rizin \
    rizin-devel \
    rpm \
    rpm-build \
    strace \
    vim \
 && dnf --assumeyes clean all

WORKDIR /scratch
RUN git clone https://git.tukaani.org/xz.git

# WONTFIX: Cannot DNF downgrade to xz-5.6.1-1.fc41, rebuilding RPM from SRPM!
# This build environment is much different, the backdoor may not get injected properly...
WORKDIR /scratch/tarballs
COPY files/* .
RUN rpmbuild -rb xz-5.6.1-1.fc41.src.rpm
